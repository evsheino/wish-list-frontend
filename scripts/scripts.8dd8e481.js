"use strict";angular.module("wishlistsApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","restangular","angular-loading-bar","angular-jwt"]).config(["$resourceProvider",function(a){a.defaults.stripTrailingSlashes=!1}]).config(["$httpProvider",function(a){a.interceptors.push("httpRequestInterceptor")}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/logout",{templateUrl:"views/main.html",controller:"LogoutCtrl"}).when("/list/edit",{templateUrl:"views/edit_list.html",controller:"EditListCtrl"}).otherwise({redirectTo:"/"})}]).config(["$animateProvider",function(a){a.classNameFilter(/animate/)}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]).config(["RestangularProvider",function(a){a.setBaseUrl("https://ancient-hamlet-3885.herokuapp.com/"),a.setRequestSuffix("/")}]).run(["$cookieStore","$interval","jwtHelper","LoginService",function(a,b,c,d){var e=36e5,f=2*e;b(function(){d.refreshToken(f)},e)}]),angular.module("wishlistsApp").factory("Users",["Restangular",function(a){return a.service("users")}]).factory("Gifts",["Restangular",function(a){return a.service("gifts")}]).factory("Categories",["Restangular",function(a){return a.service("categories")}]).factory("LoginService",["$rootScope","Restangular","$cookieStore","jwtHelper",function(a,b,c,d){var e=function(){c.remove("token"),a.isAuthenticated=!1};return{login:function(a,c){return b.service("api-token-auth/").post({username:a,password:c})},logout:e,getCurrentUser:function(){var a=c.get("token");return a?d.decodeToken(a):void 0},refreshToken:function(a){var f=c.get("token");f&&d.getTokenExpirationDate(f)-Date.now()<a&&b.service("api-token-refresh/").post({token:f}).then(function(a){c.put("token",a.token)},function(){e()})}}}]),angular.module("wishlistsApp").factory("httpRequestInterceptor",["$cookieStore","$q","$location","jwtHelper","$rootScope",function(a,b,c,d,e){return{request:function(b){var c=a.get("token");return c&&d.isTokenExpired(c)&&(a.remove("token"),c=void 0,e.isAuthenticated=!1),c&&(b.headers.Authorization="JWT "+c,e.isAuthenticated=!0),b},responseError:function(a){return(401===a.status||403===a.status)&&c.path("/login"),b.reject(a)}}}]),angular.module("wishlistsApp").controller("MainCtrl",["$scope","Users","LoginService",function(a,b,c){var d=c.getCurrentUser();d&&(a.entries=b.one(d.user_id).getList("gifts/").$object)}]),angular.module("wishlistsApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("wishlistsApp").controller("LoginCtrl",["$scope","$location","$cookieStore","LoginService","jwtHelper",function(a,b,c,d){a.passwordLogin=function(){a.loginForm.$invalid||d.login(a.email,a.pass).then(function(a){c.put("token",a.token),b.path("/")},function(b){console.log(b),a.err=b})},a.createAccount=function(){a.loginForm.$invalid||(a.err=null,a.pass!==a.confirm?a.err="Passwords do not match":simpleLogin.createAccount(a.email,a.pass,a.name).then(function(){b.path("/account")},function(b){a.err=b}))}}]).controller("LogoutCtrl",["$scope","$location","LoginService",function(a,b,c){c.logout(),b.path("/")}]),angular.module("wishlistsApp").controller("EditListCtrl",["$scope","$location","Users","Categories","Gifts","LoginService",function(a,b,c,d,e,f){var g=f.getCurrentUser();if(!g)return void b.path("/login");a.categories={},a.editMode;var h;d.getList().then(function(b){b.forEach(function(b){a.categories[b.id]=b})}),c.one(g.user_id).getList("gifts").then(function(b){a.entries=b}),a.editModeCheck=function(b){return a.editMode==b},a.startEdit=function(b){h&&h.index!=b&&a.cancelEdit(),h={index:b,gift:angular.copy(a.entries[b])},a.editMode=b},a.cancelEdit=function(){a.entries[h.index]=angular.copy(h.gift),h=null,a.editMode=null},a.save=function(b){b.category_id=b.category.id,b.put().then(function(){a.msg="Updated successfully",a.editMode=null},function(b){a.err=b})}}]);